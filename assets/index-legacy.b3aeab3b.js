System.register(["./index-legacy.f8257ec6.js","./index-legacy.7a445522.js","./dynamic-table-legacy.cb3ed346.js","./utils-legacy.0a471a24.js","./vendor-legacy.37c7624c.js","./index-legacy.d5824d17.js"],(function(e){"use strict";var a,l,n,t,d,o,r,i,s,c,u,p,m,f,h,y,v,b,g,I;return{setters:[function(e){a=e.g,l=e.u,n=e.c,t=e.a,d=e.b,o=e.d},function(e){r=e.g},function(e){i=e._},function(e){s=e.u,c=e.f,u=e.a},function(e){p=e.d,m=e.r,f=e.A,h=e.b,y=e.c,v=e.B,b=e.z,g=e.D,I=e.h},function(){}],execute:function(){const x=[{field:"name",component:"Input",label:"名称",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"label",component:"Input",label:"标识",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"menus",component:"Tree",label:"菜单权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"300px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}},{field:"depts",component:"Tree",label:"部门权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"300px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}}],k=I(" 新增 ");e("default",p({name:"SystemPermissionRole",setup(e){const p=m(),[I]=s(),w=(e,a,l=[])=>a.reduce(((a,n)=>{var t;return null!==(t=n.children)&&void 0!==t&&t.length?w(e,n.children,l):e.includes(n.value)&&a.push(n.value),a}),l),P=async e=>{var a;const[o]=await I({modalProps:{title:(e.id?"编辑":"新增")+"角色",width:"50%",onFinish:async a=>{var t,d,r,i,s;a.roleId=e.id;const c=null===(t=o.value)||void 0===t||null===(d=t.compRefs)||void 0===d?void 0:d.menus,u=null===(r=o.value)||void 0===r||null===(i=r.compRefs)||void 0===i?void 0:i.depts,m={...a,menus:[...c.halfCheckedKeys,...c.checkedKeys],depts:[...u.halfCheckedKeys,...u.checkedKeys]};console.log("新增/编辑角色",m),await(e.id?l:n)(m),null===(s=p.value)||void 0===s||s.refreshTable()}},formSchema:{labelWidth:100,layout:"vertical",schemas:x}}),[i,s]=await Promise.all([t(),r()]),m=c(s),f=u(i);if(null===(a=o.value)||void 0===a||a.updateSchema([{field:"menus",componentProps:{treeData:m}},{field:"depts",componentProps:{treeData:f}}]),e.id){var h;const a=await d({roleId:e.id}),l=a.menus.map((e=>e.menuId)),n=a.depts.map((e=>e.departmentId));null===(h=o.value)||void 0===h||h.setFieldsValue({...e,name:a.roleInfo.name,label:a.roleInfo.label,remark:a.roleInfo.remark,menus:w(l,m),depts:w(n,f)})}},C=(e=>{const{delRowConfirm:a,openMenuModal:l}=e;return[{title:"#",dataIndex:"id",width:55,align:"center",hideInSearch:!0},{title:"名称",width:200,align:"center",dataIndex:"name"},{title:"标识",width:80,align:"center",dataIndex:"label"},{title:"备注",dataIndex:"remark",align:"center"},{title:"创建时间",dataIndex:"createdAt",align:"center",hideInSearch:!0},{title:"更新时间",align:"center",dataIndex:"updatedAt",hideInSearch:!0},{title:"操作",width:160,dataIndex:"$action",hideInSearch:!0,align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys/role/update",effect:"disable"},onClick:()=>l(e)},{label:"删除",auth:"sys/role/delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>a(e)}}]}]})({openMenuModal:P,delRowConfirm:async e=>{var a;await o({roleIds:[e.id]}),null===(a=p.value)||void 0===a||a.refreshTable()}});return(e,l)=>{const n=f("a-button");return h(),y("div",null,[v(g(i),{ref_key:"dynamicTableRef",ref:p,"row-key":"id","header-title":"角色管理","data-request":g(a),columns:g(C),bordered:"",size:"small"},{toolbar:b((()=>[v(n,{type:"primary",disabled:!e.$auth("sys/role/add"),onClick:l[0]||(l[0]=e=>P({}))},{default:b((()=>[k])),_:1},8,["disabled"])])),_:1},8,["data-request","columns"])])}}}))}}}));
