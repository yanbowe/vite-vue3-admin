var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,d=(e,a)=>{for(var t in a||(a={}))r.call(a,t)&&n(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&n(e,t,a[t]);return e},s=(e,l)=>a(e,t(l));import{g as i,u as c,c as p,a as u,b as m,d as f}from"./index.b2ab008f.js";import{g as b}from"./index.20a587cf.js";import{_ as h}from"./dynamic-table.371c2694.js";import{u as y,f as v,a as I}from"./utils.d8b24be6.js";import{d as g,r as x,A as w,b as k,c as P,B as j,z as O,D as C,h as K}from"./vendor.5e124c15.js";import"./index.7c366795.js";const R=[{field:"name",component:"Input",label:"名称",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"label",component:"Input",label:"标识",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"menus",component:"Tree",label:"菜单权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"300px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}},{field:"depts",component:"Tree",label:"部门权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"300px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}}],S=K(" 新增 "),T=g(s(d({},{name:"SystemPermissionRole"}),{setup(e){const a=x(),[t]=y(),l=(e,a,t=[])=>a.reduce(((a,r)=>{var o;return(null==(o=r.children)?void 0:o.length)?l(e,r.children,t):e.includes(r.value)&&a.push(r.value),a}),t),r=async e=>{var r,o;const[n]=await t({modalProps:{title:(e.id?"编辑":"新增")+"角色",width:"50%",onFinish:async t=>{var l,r,o,i,u;t.roleId=e.id;const m=null==(r=null==(l=n.value)?void 0:l.compRefs)?void 0:r.menus,f=null==(i=null==(o=n.value)?void 0:o.compRefs)?void 0:i.depts,b=s(d({},t),{menus:[...m.halfCheckedKeys,...m.checkedKeys],depts:[...f.halfCheckedKeys,...f.checkedKeys]});console.log("新增/编辑角色",b),await(e.id?c:p)(b),null==(u=a.value)||u.refreshTable()}},formSchema:{labelWidth:100,layout:"vertical",schemas:R}}),[i,f]=await Promise.all([u(),b()]),h=v(f),y=I(i);if(null==(r=n.value)||r.updateSchema([{field:"menus",componentProps:{treeData:h}},{field:"depts",componentProps:{treeData:y}}]),e.id){const a=await m({roleId:e.id}),t=a.menus.map((e=>e.menuId)),r=a.depts.map((e=>e.departmentId));null==(o=n.value)||o.setFieldsValue(s(d({},e),{name:a.roleInfo.name,label:a.roleInfo.label,remark:a.roleInfo.remark,menus:l(t,h),depts:l(r,y)}))}},o=(e=>{const{delRowConfirm:a,openMenuModal:t}=e;return[{title:"#",dataIndex:"id",width:55,align:"center",hideInSearch:!0},{title:"名称",width:200,align:"center",dataIndex:"name"},{title:"标识",width:80,align:"center",dataIndex:"label"},{title:"备注",dataIndex:"remark",align:"center"},{title:"创建时间",dataIndex:"createdAt",align:"center",hideInSearch:!0},{title:"更新时间",align:"center",dataIndex:"updatedAt",hideInSearch:!0},{title:"操作",width:160,dataIndex:"$action",hideInSearch:!0,align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys/role/update",effect:"disable"},onClick:()=>t(e)},{label:"删除",auth:"sys/role/delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>a(e)}}]}]})({openMenuModal:r,delRowConfirm:async e=>{var t;await f({roleIds:[e.id]}),null==(t=a.value)||t.refreshTable()}});return(e,t)=>{const l=w("a-button");return k(),P("div",null,[j(C(h),{ref_key:"dynamicTableRef",ref:a,"row-key":"id","header-title":"角色管理","data-request":C(i),columns:C(o),bordered:"",size:"small"},{toolbar:O((()=>[j(l,{type:"primary",disabled:!e.$auth("sys/role/add"),onClick:t[0]||(t[0]=e=>r({}))},{default:O((()=>[S])),_:1},8,["disabled"])])),_:1},8,["data-request","columns"])])}}}));export{T as default};
