var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,d=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&o(e,a,t[a]);if(l)for(var a of l(t))s.call(t,a)&&o(e,a,t[a]);return e},r=(e,l)=>t(e,a(l));import{d as i,r as c,a6 as u,b as p,c as m,e as y,x as f,h,B as b,P as v,ck as w,cl as I,bm as g,k as x,l as k,A as C,y as P,z as S,D as _,am as j,cp as K,N as T,cq as E,aJ as O,aE as R,cr as q,cs as $,t as N,ac as F,ay as M,bf as D,ct as U,a4 as V,cu as A,aS as L}from"./vendor.5e124c15.js";/* empty css              *//* empty css               */import{_ as W}from"./dynamic-table.371c2694.js";import{r as X,t as z,w as B}from"./index.7c366795.js";import{e as G,f as J,h as H,t as Q,i as Y,a as Z}from"./index.b2ab008f.js";import{u as ee,a as te}from"./utils.d8b24be6.js";const ae={class:"split-wrapper"},le={class:"left-content"},ne=h(" 右边内容区 "),se=[y("i",null,null,-1),y("i",null,null,-1)],oe={class:"right-content"},de=h(" 右边内容区 ");var re=i({setup(e){const t=c();let a,l;const n=u.exports.throttle((function(e){t.value&&(t.value.style.width=l+e.clientX-a+"px")}),20),s=()=>{document.documentElement.style.userSelect="unset",document.documentElement.removeEventListener("mousemove",n),document.documentElement.removeEventListener("mouseup",s)},o=e=>{a=e.clientX,t.value&&(l=parseInt(window.getComputedStyle(t.value).width,10)),document.documentElement.style.userSelect="none",document.documentElement.addEventListener("mousemove",n),document.documentElement.addEventListener("mouseup",s)};return(e,a)=>(p(),m("div",ae,[y("div",{ref_key:"scalable",ref:t,class:"scalable"},[y("div",le,[f(e.$slots,"left-content",{},(()=>[ne]))]),y("div",{ref:"separator",class:"separator",onMousedown:o},se,544)],512),y("div",oe,[f(e.$slots,"right-content",{},(()=>[de]))])]))}});function ie(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!I(e)}function ce(e){return X({url:B.add,method:"post",data:e},{permCode:z(B.add),successMsg:"创建用户成功"})}function ue(e){return X({url:B.update,method:"post",data:e},{permCode:z(B.update),successMsg:"修改用户成功"})}function pe(e){return X({url:B.delete,method:"post",data:e},{permCode:z(B.delete)})}const me=[{field:"name",component:"Input",label:"部门名称",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"上级部门",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"orderNum",component:"InputNumber",label:"排序号",defaultValue:255,componentProps:{style:{width:"100%"}}}],ye=[{field:"departmentId",component:"TreeSelect",label:"所属部门",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"roles",component:"Select",label:"所属角色",rules:[{required:!0,type:"array"}],componentProps:{mode:"multiple",request:async()=>(await G()).map((e=>({label:e.name,value:e.id})))}},{field:"username",component:"Input",label:"用户名",rules:[{required:!0}]},{field:"name",component:"Input",label:"姓名",colProps:{span:12},rules:[{required:!0}]},{field:"nickName",component:"Input",label:"呢称",colProps:{span:12}},{field:"email",component:"Input",label:"邮箱",colProps:{span:12}},{field:"phone",component:"Input",label:"手机",colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"status",component:"RadioGroup",label:"状态",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],fe=[{field:"password",component:"Input",label:"新密码",rules:[{required:!0,type:"string"}]}],he=[{field:"departmentId",component:"TreeSelect",label:"转移至",rules:[{required:!0,type:"number"}]}],be={class:"flex justify-between"},ve=y("div",null,"组织架构",-1),we=h("新增部门 "),Ie=h("刷新 "),ge=h(" 编辑 "),xe=h(" 删除 "),ke=h("取消选择"),Ce=h(" 新增 "),Pe=h(" 转移 "),Se=h(" 删除 ");var _e=i(r(d({},{name:"SystemUser"}),{setup(e){const[t]=ee(),a=c(!1),l=c(),n=x({expandedKeys:[],departmentIds:[],deptTree:[]}),s=c({selectedRowKeys:[],onChange:(e,t)=>{console.log(`selectedRowKeys: ${e}`,"selectedRows: ",t),s.value.selectedRowKeys=e}}),o=k((()=>s.value.selectedRowKeys.length)),i=async(e={})=>{var a,l,s;console.log("record",e);const[o]=await t({modalProps:{title:(e.id?"编辑":"新增")+"部门",width:700,onFinish:async t=>{console.log("新增/编辑部门",t),t.id=e.id,await(e.id?J:H)(t),f()}},formSchema:{labelWidth:100,layout:"vertical",schemas:me}});null==(a=o.value)||a.updateSchema([{field:"parentId",componentProps:{treeData:[{key:-1,title:"#",children:n.deptTree}]}}]),null==(s=o.value)||s.setFieldsValue(r(d({},e),{parentId:null!=(l=e.parentId)?l:-1}))},u=async()=>{var e;const[a]=await t({modalProps:{title:"转移部门",width:700,onFinish:async e=>{await Q({departmentId:e.departmentId,userIds:s.value.selectedRowKeys.map((e=>e))})}},formSchema:{labelWidth:100,layout:"vertical",schemas:he}});null==(e=a.value)||e.updateSchema([{field:"departmentId",componentProps:{treeData:n.deptTree}}])},m=async(e={})=>{var a,s,o;const[d]=await t({modalProps:{title:(e.id?"编辑":"新增")+"用户",width:700,onFinish:async t=>{var a;console.log("新增/编辑用户",t),t.id=e.id,await(e.id?ue:ce)(t),null==(a=l.value)||a.refreshTable()}},formSchema:{labelWidth:100,layout:"vertical",schemas:ye}});if(null==(a=d.value)||a.updateSchema([{field:"departmentId",componentProps:{treeData:n.deptTree}}]),null==(s=d.value)||s.setFieldsValue(e),null==e?void 0:e.id){const{roles:t}=await(r={userId:e.id},X({url:B.info,method:"get",params:r},{permCode:z(B.info)}));null==(o=d.value)||o.setFieldsValue({roles:t})}var r},f=async()=>{a.value=!0;const e=await Z().finally((()=>a.value=!1));n.deptTree=te(e),n.expandedKeys=[...n.expandedKeys,...n.deptTree.map((e=>Number(e.key)))]};f();const I=async e=>{var t;Array.isArray(e)?V.confirm({title:"确定要删除所选的用户吗?",icon:b(A,null,null),centered:!0,onOk:async()=>{await pe({userIds:e}),f()}}):await pe({userIds:[e]}).finally(null==(t=l.value)?void 0:t.refreshTable)},G=e=>{var t,a;n.departmentIds=e,null==(a=null==(t=null==l?void 0:l.value)?void 0:t.refreshTable)||a.call(t)},ae=(e=>{const{openUpdatePasswordModal:t,openUserModal:a,delRowConfirm:l}=e;return[{title:"头像",width:80,dataIndex:"headImg",hideInSearch:!0,bodyCell:({record:e})=>b(v,{src:e.headImg},null)},{title:"姓名",width:120,dataIndex:"name",align:"center"},{title:"用户名",width:120,align:"center",dataIndex:"username"},{title:"所在部门",dataIndex:"departmentName",hideInSearch:!0,align:"center",width:180},{title:"所属角色",dataIndex:"roleNames",align:"center",hideInSearch:!0,width:220,bodyCell:({record:e})=>{let t;return b(g,null,ie(t=e.roleNames.map((e=>b(w,{color:"success",key:e},ie(e)?e:{default:()=>[e]}))))?t:{default:()=>[t]})}},{title:"呢称",width:120,align:"center",dataIndex:"nickName"},{title:"邮箱",width:120,align:"center",dataIndex:"email"},{title:"手机",width:120,align:"center",dataIndex:"phone"},{title:"备注",width:120,align:"center",dataIndex:"remark"},{title:"状态",dataIndex:"status",width:100,formItemProps:{component:"Select",componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}},bodyCell:({record:e})=>{const t=1===e.status;return b(w,{color:t?"success":"red"},{default:()=>[t?"启用":"禁用"]})}},{title:"操作",width:190,dataIndex:"$action",hideInSearch:!0,align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys/user/update",effect:"disable"},onClick:()=>a(e)},{label:"改密",auth:"sys/user/password",onClick:()=>t(e)},{label:"删除",auth:"sys/user/delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>l(e.id)}}]}]})({delRowConfirm:I,openUserModal:m,openUpdatePasswordModal:async e=>{await t({modalProps:{title:(e.id?"编辑":"新增")+"用户",width:700,onFinish:async t=>{var a;await(a={userId:e.id,password:t.password},X({url:B.password,method:"post",data:a},{permCode:z(B.password)}))}},formSchema:{labelWidth:100,layout:"vertical",schemas:fe}})}}),le=async({page:e,limit:t})=>{const a=await function(e){return X({url:B.page,method:"post",data:e},{permCode:z(B.page)})}({page:e,limit:t,departmentIds:n.departmentIds.length?n.departmentIds:void 0});return s.value.selectedRowKeys=[],a};return(e,t)=>{const d=L,r=C("a-button");return p(),P(_(re),null,{"left-content":S((()=>[y("div",be,[ve,b(_(g),null,{default:S((()=>[e.$auth("sys/dept/add")?(p(),P(_(j),{key:0,placement:"top"},{title:S((()=>[we])),default:S((()=>[b(_(K),{onClick:t[0]||(t[0]=e=>i({}))})])),_:1})):T("",!0),b(_(j),{placement:"top"},{title:S((()=>[Ie])),default:S((()=>[b(_(E),{spin:a.value,onClick:f},null,8,["spin"])])),_:1})])),_:1})]),b(_(F),{expandedKeys:_(n).expandedKeys,"onUpdate:expandedKeys":t[1]||(t[1]=e=>_(n).expandedKeys=e),autoExpandParent:"","tree-data":_(n).deptTree,onSelect:G},{title:S((({key:t,title:a,formData:l})=>[b(_(O),{trigger:["contextmenu"]},{overlay:S((()=>[b(_(R),null,{default:S((()=>[b(_(R).Item,{key:"1",disabled:!e.$auth("sys/dept/update"),onClick:e=>i(l)},{default:S((()=>[ge,b(_(q))])),_:2},1032,["disabled","onClick"]),b(d,{key:"2",disabled:!e.$auth("sys/dept/delete"),onClick:e=>{return a=t,void V.confirm({title:"确定要删除该部门吗?",icon:b(A,null,null),centered:!0,onOk:async()=>{await Y({departmentId:a}),f()}});var a}},{default:S((()=>[xe,b(_($))])),_:2},1032,["disabled","onClick"])])),_:2},1024)])),default:S((()=>[y("span",null,N(a),1)])),_:2},1024)])),_:1},8,["expandedKeys","tree-data"])])),"right-content":S((()=>[b(_(W),{ref_key:"dynamicTableRef",ref:l,"header-title":"用户管理","data-request":le,columns:_(ae),scroll:{x:2e3},"row-selection":s.value},M({toolbar:S((()=>[b(r,{type:"primary",disabled:!e.$auth("sys/user/add"),onClick:t[3]||(t[3]=e=>m({}))},{default:S((()=>[b(_(K)),Ce])),_:1},8,["disabled"]),b(r,{type:"success",disabled:!_(o)||!e.$auth("sys/dept/transfer"),onClick:u},{default:S((()=>[b(_(U)),Pe])),_:1},8,["disabled"]),b(r,{type:"danger",disabled:!_(o)||!e.$auth("sys/user/delete"),onClick:t[4]||(t[4]=e=>I(s.value.selectedRowKeys))},{default:S((()=>[b(_($)),Se])),_:1},8,["disabled"])])),_:2},[_(o)?{name:"title",fn:S((()=>[b(_(D),{class:"w-full",type:"info","show-icon":""},{message:S((()=>[h(" 已选 "+N(_(o))+" 项 ",1),b(r,{type:"link",onClick:t[2]||(t[2]=e=>s.value.selectedRowKeys=[])},{default:S((()=>[ke])),_:1})])),_:1})]))}:void 0]),1032,["columns","row-selection"])])),_:1})}}}));export{_e as default};
